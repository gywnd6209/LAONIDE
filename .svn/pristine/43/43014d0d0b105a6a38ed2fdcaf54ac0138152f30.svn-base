<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="notice">
	<typeAlias alias="noticeVO" type="kr.or.ddit.vo.NoticeVO"></typeAlias>
	
<!-- 	<resultMap id="noticeMap" class="noticeVO"> -->
<!-- 		<result property="bo_no" column="bo_no"/> -->
<!-- 		<result property="bo_title" column="bo_title"/> -->
<!-- 		<result property="bo_content" column="bo_content"/> -->
<!-- 		<result property="bo_hit" column="bo_hit"/> -->
<!-- 		<result property="bo_status" column="bo_status"/> -->
<!-- 		<result property="bo_writer" column="bo_writer"/> -->
<!-- 		<result property="bo_date" column="bo_date"/> -->
<!-- 	</resultMap> -->
	
	<sql id="selectAll">
		select * from notice
		where bo_status = 'n'
	</sql>
	
	<sql id="searchCondition">
		<dynamic prepend="and">
			<isNotEmpty property="search_keyword" open="(" close=")">
				<isEqual property="search_keycode" compareValue="total">
					bo_title like '%'||#search_keyword#||'%'
					or bo_content like '%'||#search_keyword#||'%'
				</isEqual>
				<isEqual property="search_keycode" compareValue="title">
					bo_title like '%'||#search_keyword#||'%'
				</isEqual>
				<isEqual property="search_keycode" compareValue="content">
					bo_content like '%'||#search_keyword#||'%'
				</isEqual>
			</isNotEmpty>
			
			<isNotEmpty property="search_keyword">
				and bo_status = 'n'
			</isNotEmpty>
		</dynamic>
	</sql>
	
<!-- 	<select id="noticeAllList" resultClass="noticeVO"> -->
<!-- 		select rownum rnum, a.* from -->
<!-- 			(<include refid="selectAll"/>) a -->
<!-- 		<![CDATA[ -->
<!-- 			where rnum <= #startCount# -->
<!-- 				and rnum >= #endCount# -->
<!-- 		]]> -->
<!-- 		order by rnum desc -->
<!-- <include refid="selectAll"/> -->
<!-- 	</select> -->
	
	<select id="noticeList" parameterClass="map" resultClass="noticeVO">
		select b.* from
		(select rownum rnum , a.*
			from (<include refid="selectAll"/>
					<include refid="searchCondition"/> order by bo_date) a) b
		<![CDATA[
			where b.rnum <= #startCount#
				and b.rnum >= #endCount#
		]]>
		order by rnum desc 
	</select>
	
	<select id="noticeInfo" parameterClass="map" resultClass="noticeVO">
		<include refid="selectAll"/>
		and bo_no = #bo_no#
	</select>
	
	<insert id="insertNotice" parameterClass="noticeVO">
		<selectKey keyProperty="bo_no" resultClass="String">
			select notice_seq.nextval from dual
		</selectKey>
		insert into notice(bo_no, bo_title, bo_content, bo_date, bo_status, bo_writer)
			values(#bo_no#, #bo_title#, #bo_content#, sysdate, 'n', #bo_writer#)
	</insert>
	
	<update id="updateNotice" parameterClass="noticeVO">
		update notice set bo_title = #bo_title#,
								bo_content = #bo_content#
		where bo_no = #bo_no#
	</update>
	
	<update id="deleteNotice" parameterClass="map">
		update notice set bo_status = 'y'
		where bo_no = #bo_no#
	</update>
	
	<update id="updateHit" parameterClass="map">
		update notice 
<!-- 		set bo_hit = bo_hit+1 -->
		set bo_hit = CAST(bo_hit + 1 AS NUMBER(10)) 
		where bo_no = #bo_no#
	</update>
	
	<select id="totalCount" parameterClass="map" resultClass="int">
		select count(bo_no) from notice
		where bo_status = 'n'
		<include refid="searchCondition"/>
	</select>
	
</sqlMap>